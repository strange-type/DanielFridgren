---
import { getCollection } from "astro:content";
import SEO from "../../components/seo.astro";
import Layout from "../../layouts/Layout.astro";
import PageWrapper from "../../components/layouts/PageWrapper.astro";
import type { CollectionEntry } from "astro:content";
import Spacer from "../../components/Spacer.astro";
import SubscribeSection from "../../components/layouts/SubscribeSection.astro";
import { formatDate } from "../../utils/date";

const posts = (await getCollection("blog")) as CollectionEntry<"blog">[];
const isDev = import.meta.env.DEV;
const visible = posts
  .filter((p) => isDev || !p.data.draft)
  .sort((a, b) => (a.data.pubDate > b.data.pubDate ? -1 : 1));
---

<Layout>
  <SEO
    slot="head"
    title="Blog"
    description="Writing at the intersection of systems thinking, design, and culture. Exploring emergence, adaptation, and the non-scalable forces that shape our world."
    pathname={Astro.url.pathname}
  />
  <PageWrapper>
    <main role="main" aria-labelledby="blog-heading">
      <Spacer size="xl" />

      <div class="grid-columns-2">
        <div></div>
        <div>
          <h1 id="blog-heading" class="title-display prose fadeup-st">
            Blog Posts
          </h1>
          <Spacer size="xs" />
          <ul class="post-list prose" aria-live="polite">
            {
              visible.map((post: any) => (
                <li class="post-list-item fadeup-st">
                  <a class="post-link" href={`/blog/${post.slug}`}>
                    <time
                      class="post-date metadata"
                      datetime={String(post.data.pubDate)}
                    >
                      {formatDate(post.data.pubDate)}
                    </time>
                    <div class="post-content">
                      <h2 class="post-title">{post.data.title}</h2>
                      {post.data.description ? (
                        <p class="post-description">{post.data.description}</p>
                      ) : null}
                    </div>
                  </a>
                </li>
              ))
            }
          </ul>
        </div>
      </div>
      <Spacer size="xl" />
      <SubscribeSection />

      <style>
        .post-list {
          list-style: none;
          margin: 0;
          padding: 0;
          display: flex;
          flex-direction: column;
          gap: var(--space-16);
          max-width: 42rem; /* constrain the list width */
          margin-left: 0;
        }

        .post-list-item {
          margin-bottom: 0;
          padding-block: var(--space-12);
        }

        .post-link {
          display: grid;
          grid-template-columns: minmax(0, auto) minmax(0, 1fr);
          column-gap: var(--space-24);
          align-items: baseline;
          text-decoration: none;
          color: inherit;
          padding: 0;
        }

        .post-title {
          font-family: var(--font-sans);
          font-weight: 300;
          font-size: var(--fs-md);
          margin: 0;
          color: var(--color-fg);
        }

        .metadata {
          font-size: var(--fs-sm);
          color: var(--color-subtle);
        }

        .post-date {
          font-family: var(--font-mono);
          font-size: var(--fs-xs);
          letter-spacing: 0.08em;
          text-transform: uppercase;
          color: var(--color-subtle);
          white-space: nowrap;
        }

        .post-content {
          display: flex;
          flex-direction: column;
          gap: var(--space-8);
        }

        .post-link:hover .post-title {
          text-decoration: underline;
          text-decoration-thickness: 0.08em;
          text-underline-offset: 0.2em;
        }

        @media (max-width: 640px) {
          .post-link {
            grid-template-columns: 1fr;
            row-gap: var(--space-4);
          }

          .post-date {
            justify-self: start;
          }
        }

        .post-description {
          margin-top: var(--space-12);
          color: var(--color-muted);
          font-size: var(--fs-sm);
          margin-bottom: 0;
        }
      </style>
    </main></PageWrapper
  ></Layout
>
