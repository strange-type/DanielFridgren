---
import Layout from "../layouts/Layout.astro";
import PageWrapper from "../components/layouts/PageWrapper.astro";
import Spacer from "../components/Spacer.astro";
import SEO from "../components/seo.astro";

interface Props {
    title?: string;
    desc?: string;
}

const { title = "Contact", desc = "Get in touch with me" } = Astro.props;
---

<Layout title={title} desc={desc}>
    <PageWrapper>
        <Spacer size="2xl" />
        <main>
            <div class="grid-columns-2">
                <div>
                    <h1 class="title-display fadeup-st">Contact</h1>
                </div>
                <div>
                    <Spacer size="xs" />

                    <div class="contact-text text fadeup-st prose">
                        Based in Malm√∂, Sweden, I work across strategic and
                        hands-on layers of design: from product discovery and
                        service design to interface-level UX. My journey has
                        taken me from pioneering work on the first version of
                        Android at Google to leading design teams in dynamic
                        startups and consulting for a diverse range of clients.
                        <Spacer size="xs" />
                        Want to connect, discuss ideas, a project or explore working
                        together? I'm always open to new opportunities and collaborations.
                    </div>
                    <Spacer size="small" />

                    <form class="form-contact fadeup-st" id="contact-form">
                        <input
                            type="hidden"
                            name="form-start-time"
                            id="form-start-time"
                        />

                        <!-- Honeypot field -->
                        <div
                            style="position: absolute; left: -5000px;"
                            aria-hidden="true"
                        >
                            <label for="website">
                                Leave this field empty
                                <input
                                    type="text"
                                    name="website"
                                    id="website"
                                    tabindex="-1"
                                    autocomplete="off"
                                />
                            </label>
                        </div>

                        <div class="form-field">
                            <label for="name" class="form-label"> Name </label>
                            <input
                                class="form-input"
                                type="text"
                                id="name"
                                name="name"
                                required
                                placeholder="Your name"
                            />
                        </div>

                        <div class="form-field">
                            <label for="email" class="form-label">
                                Email Address
                            </label>
                            <input
                                class="form-input"
                                type="email"
                                id="email"
                                name="email"
                                required
                                placeholder="your@email.com"
                            />
                        </div>

                        <div class="form-field">
                            <label for="message" class="form-label">
                                Message
                            </label>
                            <textarea
                                class="form-input form-textarea"
                                id="message"
                                name="message"
                                required
                                placeholder="Write here..."
                                rows="6"></textarea>
                        </div>

                        <button
                            type="submit"
                            class="button"
                            id="submit-button"
                            data-umami-event="Contact Form Submit"
                        >
                            Send Message
                        </button>
                        <p
                            id="form-status"
                            class="text-sm"
                            style="margin-top: var(--space-2xs); display: none;"
                        >
                        </p>
                    </form>

                    <Spacer size="2xl" />
                    <Spacer size="xl" />
                </div>
            </div>
        </main>
    </PageWrapper>

    <style>
        .contact-text {
            max-width: 44ch;
        }

        .contact-image {
            padding: 20px;
        }

        .form-contact {
            margin-top: var(--space-m);
            max-width: 44ch;
        }

        .form-field {
            margin-bottom: var(--space-s);
        }

        .form-contact .form-input {
            width: 100%;
        }

        .form-textarea {
            resize: vertical;
            min-height: 120px;
            font-family: inherit;
            line-height: 1.5;
        }
    </style>

    <script>
        // Set form start time for bot detection
        document.addEventListener("DOMContentLoaded", () => {
            const formStartTime = document.getElementById(
                "form-start-time",
            ) as HTMLInputElement;
            if (formStartTime) {
                formStartTime.value = Date.now().toString();
            }

            // Handle form submission
            const form = document.getElementById(
                "contact-form",
            ) as HTMLFormElement;
            const submitButton = document.getElementById(
                "submit-button",
            ) as HTMLButtonElement;
            const statusMessage = document.getElementById(
                "form-status",
            ) as HTMLParagraphElement;

            form?.addEventListener("submit", async (e) => {
                e.preventDefault();

                // Disable button and show loading state
                submitButton.disabled = true;
                submitButton.textContent = "Sending...";
                statusMessage.style.display = "none";

                try {
                    const formData = new FormData(form);
                    const response = await fetch(
                        "/.netlify/functions/contact",
                        {
                            method: "POST",
                            body: new URLSearchParams(formData as any),
                        },
                    );

                    if (response.ok) {
                        // Redirect to confirmation page
                        window.location.href = "/confirmation?type=contact";
                    } else {
                        const data = await response.json();
                        statusMessage.textContent =
                            data.error ||
                            "Something went wrong. Please try again.";
                        statusMessage.style.display = "block";
                        statusMessage.style.color = "var(--color-red)";
                        submitButton.disabled = false;
                        submitButton.textContent = "Send Message";
                    }
                } catch (error) {
                    statusMessage.textContent =
                        "Network error. Please try again.";
                    statusMessage.style.display = "block";
                    statusMessage.style.color = "var(--color-red)";
                    submitButton.disabled = false;
                    submitButton.textContent = "Send Message";
                }
            });
        });
    </script>
</Layout>
