---
import Layout from "../layouts/Layout.astro";
import Spacer from "../components/mdx/Spacer.astro";
---

<Layout
    title="Newsletter Subscription"
    desc="Subscribe to receive updates and insights on design, technology, and complex systems"
>
    <div class="container mx-auto px-4 py-16 max-w-2xl">
        <h1 class="text-4xl md:text-5xl font-bold mb-6">Newsletter</h1>

        <Spacer size="sm" />

        <p class="body-text mb-8">
            Subscribe to receive occasional updates about design, technology,
            and complex systems. I share thoughts on emergence, cognition, and
            the patterns that shape our digital world.
        </p>

        <Spacer size="md" />

        <div id="form-container">
            <form
                name="newsletter"
                method="POST"
                data-netlify="true"
                netlify-honeypot="bot-field"
                class="space-y-6"
            >
                <!-- Hidden form name for Netlify -->
                <input type="hidden" name="form-name" value="newsletter" />

                <!-- Honeypot field for spam protection -->
                <div style="display: none;">
                    <label>
                        Don't fill this out if you're human:
                        <input name="bot-field" />
                    </label>
                </div>

                <div>
                    <label for="email" class="block text-sm font-medium mb-2">
                        Email Address
                    </label>
                    <input
                        type="email"
                        id="email"
                        name="email"
                        required
                        placeholder="your@email.com"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                    />
                </div>

                <button
                    type="submit"
                    class="w-full px-6 py-3 bg-black text-white font-medium rounded-lg hover:bg-gray-800 transition-colors duration-200"
                >
                    Subscribe
                </button>
            </form>

            <div
                id="success-message"
                class="hidden mt-6 p-4 bg-green-50 border border-green-200 rounded-lg"
            >
                <p class="text-green-800">
                    ✓ Thank you for subscribing! Please check your email to
                    confirm your subscription.
                </p>
            </div>

            <div
                id="error-message"
                class="hidden mt-6 p-4 bg-red-50 border border-red-200 rounded-lg"
            >
                <p class="text-red-800">
                    ✗ Something went wrong. Please try again later.
                </p>
            </div>
        </div>

        <Spacer size="sm" />

        <p class="text-sm text-gray-600 mt-6">
            Your email will only be used to send you newsletter updates. You can
            unsubscribe at any time.
        </p>
    </div>
</Layout>

<script>
    const form = document.querySelector('form[name="newsletter"]');
    const successMessage = document.getElementById("success-message");
    const errorMessage = document.getElementById("error-message");

    if (form && successMessage && errorMessage) {
        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            // Hide any previous messages
            successMessage.classList.add("hidden");
            errorMessage.classList.add("hidden");

            const formData = new FormData(form);
            const email = formData.get("email");
            const botField = formData.get("bot-field");

            // Check honeypot
            if (botField) {
                errorMessage.classList.remove("hidden");
                return;
            }

            try {
                const response = await fetch("/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded",
                    },
                    body: new URLSearchParams(formData as any).toString(),
                });

                if (response.ok) {
                    successMessage.classList.remove("hidden");
                    form.reset();
                } else {
                    errorMessage.classList.remove("hidden");
                }
            } catch (error) {
                console.error("Submission error:", error);
                errorMessage.classList.remove("hidden");
            }
        });
    }
</script>
