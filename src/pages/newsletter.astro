---
import Layout from "../layouts/Layout.astro";
import PageWrapper from "../components/layouts/PageWrapper.astro";
import Spacer from "../components/Spacer.astro";
---

<Layout
    title="About Me"
    desc="Designer and developer focused on creating meaningful digital experiences"
>
    <PageWrapper>
        <Spacer size="xl" />
        <main>
            <div class="grid-columns-2">
                <div></div>
                <section id="experience" class="section">
                    <p class="title-section"></p>
                    <div class="prose">
                        <h1 class="title-display fadeup-st">Subscribe</h1>
                        <div class="text">
                            <Spacer size="xs" />

                            <p class="text prose fadeup-st">
                                Subscribe to receive occasional updates about
                                design, technology, and complex systems. I share
                                thoughts on emergence, cognition, and the
                                patterns that shape our digital world.
                            </p>
                            <form
                                class="form-newsletter fadeup-st"
                                id="newsletter-form"
                            >
                                <label for="email" class="form-label">
                                    Email Address
                                </label>
                                <div class="form-group">
                                    <input
                                        class="form-input"
                                        type="email"
                                        id="email"
                                        name="email"
                                        required
                                        placeholder="your@email.com"
                                        data-umami-event="newsletter-subscribe"
                                    />
                                    <button
                                        type="submit"
                                        class="button"
                                        id="newsletter-submit"
                                    >
                                        Subscribe
                                    </button>
                                </div>
                                <p
                                    id="newsletter-status"
                                    class="text-sm"
                                    style="margin-top: var(--space-2xs); display: none;"
                                >
                                </p>
                            </form>
                            <Spacer size="xs" />
                            <p class="text-sm prose fadeup-st">
                                Your email will only be used to send you
                                newsletter updates. You can unsubscribe at any
                                time.
                            </p>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </PageWrapper>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const form = document.getElementById(
                "newsletter-form",
            ) as HTMLFormElement;
            const submitButton = document.getElementById(
                "newsletter-submit",
            ) as HTMLButtonElement;
            const statusMessage = document.getElementById(
                "newsletter-status",
            ) as HTMLParagraphElement;

            form?.addEventListener("submit", async (e) => {
                e.preventDefault();

                const emailInput = document.getElementById(
                    "email",
                ) as HTMLInputElement;
                const email = emailInput.value;

                // Disable button and show loading state
                submitButton.disabled = true;
                submitButton.textContent = "Subscribing...";
                statusMessage.style.display = "none";

                try {
                    const response = await fetch(
                        "/.netlify/functions/subscribe-email",
                        {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({ data: { email } }),
                        },
                    );

                    if (response.ok) {
                        // Redirect to confirmation page
                        window.location.href = "/confirmation";
                    } else {
                        const data = await response.json();
                        statusMessage.textContent =
                            data.message ||
                            "Something went wrong. Please try again.";
                        statusMessage.style.display = "block";
                        statusMessage.style.color = "var(--color-red)";
                        submitButton.disabled = false;
                        submitButton.textContent = "Subscribe";
                    }
                } catch (error) {
                    statusMessage.textContent =
                        "Network error. Please try again.";
                    statusMessage.style.display = "block";
                    statusMessage.style.color = "var(--color-red)";
                    submitButton.disabled = false;
                    submitButton.textContent = "Subscribe";
                }
            });
        });
    </script>
</Layout>
