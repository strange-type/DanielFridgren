---
import Layout from "../../layouts/Layout.astro";
import Spacer from "../../components/Spacer.astro";
import PageWrapper from "../../components/layouts/PageWrapper.astro";
import ContactSection from "../../components/layouts/ContactSection.astro";
import SEO from "../../components/seo.astro";

const modules = import.meta.glob("../../content/work/*.md", {
  eager: true,
}) as Record<string, any>;

const moduleKeys = Object.keys(modules || {});

const posts = moduleKeys
  .map((path) => {
    const mod = (modules as Record<string, any>)[path];
    const fm = (mod as any).frontmatter || {};
    const filename = path.match(/([^/\\]+)\.md$/)?.[1] || "";
    const slug = fm.slug || filename;
    return {
      ...fm,
      url: `/work/${slug}`,
      __path: path,
    };
  })
  .sort(
    (a, b) => (Date.parse(b.date || "") || 0) - (Date.parse(a.date || "") || 0),
  );
---

<title>Work</title>
<meta
  name="description"
  content="Selected case studies from Daniel Fridgren, showcasing expertise in UX and product design across various industries."
/>
<link rel="canonical" href="https://fridgren.se/work/" />

<meta property="og:title" content="Work | Daniel Fridgren" />
<meta
  property="og:description"
  content="Selected case studies from Daniel Fridgren, showcasing expertise in UX and product design across various industries."
/>
<meta
  property="og:image"
  content="https://fridgren.se/images/og-image.png"
/>
<meta property="og:url" content="https://fridgren.se/work/" />
<meta property="og:type" content="page" />

<Layout title="Work">
  <SEO
    title="Work â€” Daniel Fridgren"
    description="Selected case studies in UX, research and product design."
    pathname={Astro.url.pathname}
  />
  <PageWrapper>
    <section id="work" class="section">
      <Spacer size="xl" />
      <div class="grid-columns-2">
        <p class="title-section"></p>
        <div>
          <h1 class="title-display fadeup-st">Selected case studies</h1>
          <div class="text fadeup-st">
            A curated mix of UX, discovery and research work from recent
            engagements.
          </div>
          <Spacer />
          <div class="portfolio">
            {
              posts.map((p) => (
                <a
                  class="portfolio-item link-unstyled fadeup-st"
                  href={p.url}
                  aria-label={`Open case study about ${p.title || p.__path}`}
                >
                  {p.heroImage || p.image ? (
                    <figure class="portfolio-figure">
                      <img
                        src={p.heroImage || p.image || "/images/og-image.png"}
                        alt={p.title || ""}
                        loading="lazy"
                      />
                    </figure>
                  ) : null}

                  <div class="portfolio-card-header fadeup-st">
                    <div class="text portfolio-card-title">
                      {p.title || p.excerpt || ""}
                    </div>
                    <h3 class="portfolio-card-subtitle">
                      {p.client || p.__path}
                    </h3>
                  </div>
                </a>
              ))
            }
          </div>

          {
            posts.length === 0 ? (
              <div class="text-muted">
                <p>No case posts found. Diagnostic info (development only):</p>
                <pre style="white-space:pre-wrap; background:#f6f6f6; padding:8px; border-radius:4px;">
                  {JSON.stringify(Object.keys(modules || {}), null, 2)}
                </pre>
              </div>
            ) : null
          }
        </div>
      </div>
    </section>
    <Spacer size="xl" />
    <ContactSection />
  </PageWrapper>
</Layout>
