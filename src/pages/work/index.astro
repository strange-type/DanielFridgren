---
import Layout from "../../layouts/Layout.astro";
import Spacer from "../../components/Spacer.astro";
import PageWrapper from "../../components/layouts/PageWrapper.astro";
import ContactSection from "../../components/layouts/ContactSection.astro";
import SEO from "../../components/seo.astro";
import { getCollection } from "astro:content";

const workItems = await getCollection("work");
const posts = workItems
  .map((item) => ({
    ...item.data,
    slug: item.slug,
    url: `/work/${item.slug}/`,
  }))
  .sort(
    (a, b) => (Date.parse(b.date || "") || 0) - (Date.parse(a.date || "") || 0),
  );
---

<Layout title="Work">
  <SEO
    slot="head"
    title="Work"
    description="Selected case studies in UX, research and product design."
    pathname={Astro.url.pathname}
  />
  <PageWrapper>
    <section id="work" class="section">
      <Spacer size="xl" />
      <div class="grid-columns-2">
        <p class="title-section"></p>
        <div>
          <h1 class="title-display fadeup-st">Selected case studies</h1>
          <div class="text fadeup-st">
            A curated mix of UX, discovery and research work from recent
            engagements.
          </div>
          <Spacer />
          <div class="portfolio">
            {
              posts.map((p) => (
                <a
                  class="portfolio-item link-unstyled fadeup-st"
                  href={p.url}
                  aria-label={`Open case study about ${p.title || p.slug}`}
                >
                  {p.heroImage ? (
                    <figure class="portfolio-figure">
                      <img
                        src={p.heroImage || "/images/og-image.png"}
                        alt={p.title || ""}
                        loading="lazy"
                      />
                    </figure>
                  ) : null}

                  <div class="portfolio-card-header fadeup-st">
                    <div class="text portfolio-card-title">{p.title || ""}</div>
                    <h3 class="portfolio-card-subtitle">
                      {p.client || p.slug}
                    </h3>
                  </div>
                </a>
              ))
            }
          </div>

          {
            posts.length === 0 ? (
              <div class="text">
                <p>No case posts found.</p>
              </div>
            ) : null
          }
        </div>
      </div>
    </section>
    <Spacer size="xl" />
    <ContactSection />
  </PageWrapper>
</Layout>
