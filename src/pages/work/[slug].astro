---
// src/pages/work/[slug].astro
import CaseLayout from "../../layouts/CaseLayout.astro";
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";

export async function getStaticPaths() {
  const workItems = await getCollection("work");
  return workItems.map((item) => ({
    params: { slug: item.slug },
  }));
}

const { slug } = Astro.params;
if (!slug) throw new Error("Missing slug param");

const workItems = await getCollection("work");
const workItem = workItems.find((item) => item.slug === slug);

if (!workItem) {
  throw new Response(null, { status: 404 });
}

const { Content } = await workItem.render();
const frontmatter = { ...workItem.data, slug: workItem.slug };
---

<CaseLayout {frontmatter}>
  <Content />
</CaseLayout>
